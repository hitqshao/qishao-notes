---
title: Understanding GPGPU-SIM & GPGPU-SIM UVM_SMART (3)
date: 2024-08-13
permalink: /pages/458727/
---

### How is the simulation started?

#### From Binary File

```
   0x000000000040171f <+13>:    callq  0x400ad0 <__cudaRegisterFatBinary@plt>
=> 0x0000000000401724 <+18>:    mov    %rax,0x2029f5(%rip)        # 0x604120 <_ZL20__cudaFatCubinHandle>
```

```
// @@@@@@ cuda_runtime_api.cc
void** CUDARTAPI __cudaRegisterFatBinary( void *fatCubin ) {
	CUctx_st *context = GPGPUSim_Context();
}

static CUctx_st* GPGPUSim_Context()
{
	static CUctx_st *the_context = NULL;
	if( the_context == NULL ) {
		_cuda_device_id *the_gpu = GPGPUSim_Init();
		the_context = new CUctx_st(the_gpu);
	}
	return the_context;
}

class _cuda_device_id *GPGPUSim_Init()
{
	static _cuda_device_id *the_device = NULL;
	if( !the_device ) {
		gpgpu_sim *the_gpu = gpgpu_ptx_sim_init_perf();

		cudaDeviceProp *prop = (cudaDeviceProp *) calloc(sizeof(cudaDeviceProp),1);
		...
		the_gpu->set_prop(prop);
		the_device = new _cuda_device_id(the_gpu);
	}
	start_sim_thread(1);
	return the_device;
}
```

```
// @@@@@@ gpgpusim_entrypoint.cc
void start_sim_thread(int api)
{
    if( g_sim_done ) {
        g_sim_done = false;
	...
	pthread_create(&g_simulation_thread,NULL,gpgpu_sim_thread_concurrent,NULL);

    }
}
```

```
// @@@@@@ stream_manger.cc
bool stream_operation::do_operation( gpgpu_sim *gpu )
{
    ...
    case stream_kernel_launch:
        if( m_sim_mode ) { //Functional Sim
            gpu->set_cache_config(m_kernel->name());
            gpu->functional_launch( m_kernel );
        }
        else { //Performance Sim
            if( gpu->can_start_kernel() && m_kernel->m_launch_latency == 0) {
                gpu->set_cache_config(m_kernel->name());
                gpu->launch( m_kernel );

		            gpu->getGmmu()->log_kernel_info(m_kernel->get_uid(), gpu_sim_cycle + gpu_tot_sim_cycle, false);

		            if(sim_prof_enable) {
			              kernel_stats* k_s = new kernel_stats(cur_cycle, m_stream->get_uid(), m_kernel->get_uid());
			              sim_prof[cur_cycle].push_back(k_s);
		            }			
            }
            else {
                return false;    
            }
        }
        break;
}
```
