---
title: Getting Started with LLVM Core Libraries-Notes Chap6 Backend
date: 2023-11-21
permalink: /pages/000003/
---
### Chap6. The Backend
![image](https://github.com/hitqshao/qishao-notes/assets/23403286/a5566aac-5d9f-40c4-810b-ec6572a3e94f)

**White box** Essential
**Gray Block** For generated code efficiency
#### 1. Instructon Selection<br>
  * Convert IR to target-specific SelectionDAG(Directed Acyclic Graph)
    - Block->DAG
    - Instruction->Node
    - Edge contains dataflow dependence and control dependence and glue.
  * LLVM use DAG to employ tree-based pattern-matching instruction selection.
  * IN the end of this phase, IR node are converted to target-machine(machine instructions) nodes.
#### 2. Pre-register Allocation(RA) scheduling,the first instruction scheduling.<br>
  * This is to explore instruction-level parallelism
  * The instructions are converted to MachineInstr three-address representation.
#### 3. Reguster Allocation<br>
#### 4. Post-register Allocation(RA) Instruction Scheduling, the second instruction scheduling
  * Now we have real register information, we can combine information of extra hazards and delays of real register to opmitize code.
#### 5. Code Emission
  * Convert MachineInstr to MCInst
  * Emit Assembly Code
  * Emit Binary blobs to object code format 

### Using the backend tools
```
llc *bc -o *.s
llc *.bc -filetype=obj -o *.o

llc *.bc -march=mips -filetype=obj -o *.o

// how march options
llc -version
```

### Learning backend struture

* CodeGen: Instruction selection, scheduler,register allocation
* MC: assembly parser, disassembler
* TableGen
* Target/*.cpp *.h *.td

![image](https://github.com/hitqshao/qishao-notes/assets/23403286/723f687b-0303-4add-89ea-5fe88676049c)

### Knowing backend libraries
* <Target>AsmParser.a
* <Target>AsmPrinter.a
* <Target>CodeGen.a
  - majority of the target-dependent functionality of the backend, as followingï¼š
  - specific register handling rules, instruction selection, and scheduling
* <Target>Desc.a
  -  low-level MC infrastructure and is responsible for registering target-specific MC objects such as MCCodeEmitter
* <Target>Info.a
* <Target>Disassembler.a

### Learning how to use TableGen for LLVM backends

* instruction formats,
* instructions,
* registers,
* pattern-matching DAGs,
* instruction selection matching order,
* calling conventions,
* target CPU properties (supported Instruction Set Architecture (ISA) features and processor families).

![image](https://github.com/hitqshao/qishao-notes/assets/23403286/e85b4512-f6d2-475d-bb4b-7fdb6a2bf8e8)

![image](https://github.com/hitqshao/qishao-notes/assets/23403286/843b44f4-7d07-470d-85f8-5ff7c3aa167d)


