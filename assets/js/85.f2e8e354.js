(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{547:function(e,t,n){"use strict";n.r(t);var a=n(8),i=Object(a.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"discovered-inner-behaviors-of-transformer-based-language-models"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#discovered-inner-behaviors-of-transformer-based-language-models"}},[e._v("#")]),e._v(" Discovered Inner Behaviors of Transformer-based Language Models")]),e._v(" "),t("p",[e._v("In this blog, we will explore the "),t("strong",[e._v("discovered inner behaviors")]),e._v(" of Transformer-based language models (LMs) as outlined in the paper "),t("em",[e._v('"A Primer on the Inner Workings of Transformer-based Language Models"')]),e._v(". The paper provides a comprehensive overview of the internal mechanisms that enable these models to perform complex language tasks. We will break down the findings into five key sections:")]),e._v(" "),t("ol",[t("li",[t("strong",[e._v("Attention Block")])]),e._v(" "),t("li",[t("strong",[e._v("Feedforward Network Block")])]),e._v(" "),t("li",[t("strong",[e._v("Residual Stream")])]),e._v(" "),t("li",[t("strong",[e._v("Emergent Multi-component Behavior")])]),e._v(" "),t("li",[t("strong",[e._v("Factuality and Hallucinations in Model Predictions")])])]),e._v(" "),t("p",[e._v("Let’s dive into each of these sections to understand how these components contribute to the overall functioning of Transformer-based LMs.")]),e._v(" "),t("hr"),e._v(" "),t("h2",{attrs:{id:"_1-attention-block"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-attention-block"}},[e._v("#")]),e._v(" 1. Attention Block")]),e._v(" "),t("p",[e._v("The "),t("strong",[e._v("attention mechanism")]),e._v(" is a cornerstone of Transformer models, allowing them to contextualize token representations at each layer. The attention block consists of multiple "),t("strong",[e._v("attention heads")]),e._v(", each responsible for attending to different parts of the input sequence. The paper categorizes the behaviors of attention heads into two main groups:")]),e._v(" "),t("h3",{attrs:{id:"_1-1-attention-heads-with-interpretable-attention-weights-patterns"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-attention-heads-with-interpretable-attention-weights-patterns"}},[e._v("#")]),e._v(" 1.1 Attention Heads with Interpretable Attention Weights Patterns")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("Positional Heads")]),e._v(": These heads attend to specific positions relative to the current token, such as the previous or next token. For example, "),t("strong",[e._v("previous token heads")]),e._v(" are crucial for copying information from the previous token to the current position, which is essential for tasks like name concatenation.")]),e._v(" "),t("li",[t("strong",[e._v("Subword Joiner Heads")]),e._v(": These heads focus on subwords that belong to the same word, helping the model understand word-level structures.")]),e._v(" "),t("li",[t("strong",[e._v("Syntactic Heads")]),e._v(": These heads attend to tokens with specific syntactic roles, such as subjects or objects, and are crucial for understanding grammatical relationships.")]),e._v(" "),t("li",[t("strong",[e._v("Duplicate Token Heads")]),e._v(": These heads attend to previous occurrences of the same token, which is useful for tasks like identifying repeated names in a context.")])]),e._v(" "),t("h3",{attrs:{id:"_1-2-attention-heads-with-interpretable-qk-and-ov-circuits"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-attention-heads-with-interpretable-qk-and-ov-circuits"}},[e._v("#")]),e._v(" 1.2 Attention Heads with Interpretable QK and OV Circuits")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("Copying Heads")]),e._v(": These heads have "),t("strong",[e._v("OV (output-value) circuits")]),e._v(" that exhibit copying behavior, meaning they can replicate information from one part of the sequence to another.")]),e._v(" "),t("li",[t("strong",[e._v("Induction Heads")]),e._v(': These heads are responsible for completing patterns. For example, given a sequence like "A B ... A", the model predicts "B". This mechanism involves two heads: a '),t("strong",[e._v("previous token head")]),e._v(" that writes information into the residual stream, and an "),t("strong",[e._v("induction head")]),e._v(" that reads this information to complete the pattern.")]),e._v(" "),t("li",[t("strong",[e._v("Copy Suppression Heads")]),e._v(": These heads reduce the logit score of a token if it appears in the context and is being confidently predicted. This mechanism improves model calibration by preventing naive copying.")]),e._v(" "),t("li",[t("strong",[e._v("Successor Heads")]),e._v(': These heads predict the next element in an ordinal sequence (e.g., "Monday" → "Tuesday"). They rely on the output of the first '),t("strong",[e._v("feedforward network (FFN)")]),e._v(" block, which encodes a numerical structure.")])]),e._v(" "),t("h3",{attrs:{id:"_1-3-other-noteworthy-attention-properties"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-other-noteworthy-attention-properties"}},[e._v("#")]),e._v(" 1.3 Other Noteworthy Attention Properties")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("Domain Specialization")]),e._v(": Some heads are specialized for specific domains, such as non-English languages or coding sequences.")]),e._v(" "),t("li",[t("strong",[e._v("Attention Sinks")]),e._v(": Certain heads attend to special tokens (e.g., BOS or punctuation) when their specialized function is not applicable. This behavior is crucial for streaming generation and model performance.")])]),e._v(" "),t("hr"),e._v(" "),t("h2",{attrs:{id:"_2-feedforward-network-block"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-feedforward-network-block"}},[e._v("#")]),e._v(" 2. Feedforward Network Block")]),e._v(" "),t("p",[e._v("The "),t("strong",[e._v("feedforward network (FFN)")]),e._v(" block is another critical component of Transformer models. It consists of two learnable weight matrices and an element-wise non-linear activation function. The FFN block has been studied extensively, with a focus on the behavior of individual neurons.")]),e._v(" "),t("h3",{attrs:{id:"_2-1-neuron-s-input-behavior"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-neuron-s-input-behavior"}},[e._v("#")]),e._v(" 2.1 Neuron's Input Behavior")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("Position Ranges")]),e._v(": Some neurons fire exclusively on specific position ranges within the input sequence.")]),e._v(" "),t("li",[t("strong",[e._v("Skill Neurons")]),e._v(": These neurons activate based on the task of the input prompt, such as detecting whether the input is Python code or French text.")]),e._v(" "),t("li",[t("strong",[e._v("Concept-Specific Neurons")]),e._v(": These neurons respond to specific concepts, such as grammatical features or semantic roles.")])]),e._v(" "),t("h3",{attrs:{id:"_2-2-neuron-s-output-behavior"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-neuron-s-output-behavior"}},[e._v("#")]),e._v(" 2.2 Neuron's Output Behavior")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("Knowledge Neurons")]),e._v(": These neurons are responsible for predicting factual information, such as the capital of a country.")]),e._v(" "),t("li",[t("strong",[e._v("Linguistically Acceptable Predictions")]),e._v(": Some neurons ensure that the model's predictions are grammatically correct, such as predicting the correct verb number based on the subject.")]),e._v(" "),t("li",[t("strong",[e._v("Token Frequency Neurons")]),e._v(": These neurons adjust the logits of tokens based on their frequency in the training data, shifting the output distribution towards or away from the unigram distribution.")])]),e._v(" "),t("h3",{attrs:{id:"_2-3-polysemantic-neurons"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-polysemantic-neurons"}},[e._v("#")]),e._v(" 2.3 Polysemantic Neurons")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("N-gram Detectors")]),e._v(": Many neurons in early layers specialize in detecting n-grams, but they often fire on a large number of unrelated n-grams, indicating "),t("strong",[e._v("polysemanticity")]),e._v(".")]),e._v(" "),t("li",[t("strong",[e._v("Dead Neurons")]),e._v(": Some neurons in models like OPT remain inactive (zero activation) due to the ReLU activation function.")])]),e._v(" "),t("h3",{attrs:{id:"_2-4-universality-of-neurons"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-universality-of-neurons"}},[e._v("#")]),e._v(" 2.4 Universality of Neurons")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("Universal Neurons")]),e._v(": Across different models, a small subset of neurons (1-5%) activate on the same inputs. These include "),t("strong",[e._v("alphabet neurons")]),e._v(", "),t("strong",[e._v("previous token neurons")]),e._v(", and "),t("strong",[e._v("entropy neurons")]),e._v(", which modulate the model's uncertainty over the next token prediction.")])]),e._v(" "),t("hr"),e._v(" "),t("h2",{attrs:{id:"_3-residual-stream"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-residual-stream"}},[e._v("#")]),e._v(" 3. Residual Stream")]),e._v(" "),t("p",[e._v("The "),t("strong",[e._v("residual stream")]),e._v(" is the main communication channel in a Transformer model. It carries information from one layer to the next, with each layer adding its updates to the stream.")]),e._v(" "),t("h3",{attrs:{id:"_3-1-information-flow-in-the-residual-stream"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-information-flow-in-the-residual-stream"}},[e._v("#")]),e._v(" 3.1 Information Flow in the Residual Stream")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("Direct Path")]),e._v(": The direct path from the input embedding to the unembedding matrix mainly models bigram statistics.")]),e._v(" "),t("li",[t("strong",[e._v("Memory Management")]),e._v(": Some components, such as attention heads and FFN neurons, remove information from the residual stream to manage memory. For example, certain neurons write vectors in the opposite direction of what they read, effectively canceling out information.")])]),e._v(" "),t("h3",{attrs:{id:"_3-2-outlier-dimensions"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-outlier-dimensions"}},[e._v("#")]),e._v(" 3.2 Outlier Dimensions")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("Rogue Dimensions")]),e._v(": These are dimensions in the residual stream with unusually large magnitudes. They are associated with the generation of "),t("strong",[e._v("anisotropic representations")]),e._v(", where the residual stream states of random tokens tend to point in the same direction. Ablating these dimensions significantly decreases model performance, suggesting they encode task-specific knowledge.")])]),e._v(" "),t("h3",{attrs:{id:"_3-3-features-in-the-residual-stream"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-features-in-the-residual-stream"}},[e._v("#")]),e._v(" 3.3 Features in the Residual Stream")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("Sparse Autoencoders (SAEs)")]),e._v(": SAEs have been used to identify interpretable features in the residual stream. These features include "),t("strong",[e._v("local context features")]),e._v(", "),t("strong",[e._v("partition features")]),e._v(" (which promote or suppress specific sets of tokens), and "),t("strong",[e._v("suppression features")]),e._v(" (which reduce the likelihood of certain tokens).")])]),e._v(" "),t("hr"),e._v(" "),t("h2",{attrs:{id:"_4-emergent-multi-component-behavior"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-emergent-multi-component-behavior"}},[e._v("#")]),e._v(" 4. Emergent Multi-component Behavior")]),e._v(" "),t("p",[e._v("Transformer models achieve their remarkable performance through the "),t("strong",[e._v("interaction of multiple components")]),e._v(". The paper highlights several examples of emergent behaviors that arise from these interactions.")]),e._v(" "),t("h3",{attrs:{id:"_4-1-evidence-of-multi-component-behavior"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-evidence-of-multi-component-behavior"}},[e._v("#")]),e._v(" 4.1 Evidence of Multi-component Behavior")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("Induction Mechanism")]),e._v(": This mechanism involves two attention heads working together to complete patterns. A "),t("strong",[e._v("previous token head")]),e._v(" writes information into the residual stream, and an "),t("strong",[e._v("induction head")]),e._v(" reads this information to predict the next token.")]),e._v(" "),t("li",[t("strong",[e._v("Function Vectors")]),e._v(": Multiple attention heads create "),t("strong",[e._v("function vectors")]),e._v(" that describe a task when given in-context examples. Intervening in the residual stream with these vectors can produce outputs that align with the encoded task.")])]),e._v(" "),t("h3",{attrs:{id:"_4-2-circuits-analysis"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-circuits-analysis"}},[e._v("#")]),e._v(" 4.2 Circuits Analysis")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("IOI Circuit")]),e._v(": In the "),t("strong",[e._v("Indirect Object Identification (IOI)")]),e._v(' task, the model identifies the correct name (e.g., "Mary") in a sentence like "When Mary and John went to the store, John gave a drink to _____". The circuit involves '),t("strong",[e._v("duplicate token heads")]),e._v(", "),t("strong",[e._v("name mover heads")]),e._v(", and "),t("strong",[e._v("negative mover heads")]),e._v(" (which suppress incorrect predictions).")]),e._v(" "),t("li",[t("strong",[e._v("Greater-than Circuit")]),e._v(": In the "),t("strong",[e._v("greater-than task")]),e._v(', the model predicts a year greater than a given year (e.g., "1814" → "1815"). The circuit involves attention heads that attend to the initial date and FFNs that compute the correct year.')])]),e._v(" "),t("h3",{attrs:{id:"_4-3-generality-of-circuits"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-generality-of-circuits"}},[e._v("#")]),e._v(" 4.3 Generality of Circuits")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("Fine-tuning")]),e._v(": The functionality of circuit components remains consistent after fine-tuning, suggesting that fine-tuning improves the encoding of task-relevant information rather than rearranging the circuit.")]),e._v(" "),t("li",[t("strong",[e._v("Grokking")]),e._v(": The sudden emergence of generalization capabilities in models (known as "),t("strong",[e._v("grokking")]),e._v(") is linked to the formation of sparse circuits that replace dense, memorizing sub-networks.")])]),e._v(" "),t("hr"),e._v(" "),t("h2",{attrs:{id:"_5-factuality-and-hallucinations-in-model-predictions"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-factuality-and-hallucinations-in-model-predictions"}},[e._v("#")]),e._v(" 5. Factuality and Hallucinations in Model Predictions")]),e._v(" "),t("p",[e._v("One of the challenges with large language models is their tendency to generate "),t("strong",[e._v("factually incorrect or nonsensical outputs")]),e._v(" (hallucinations). The paper explores the internal mechanisms behind these behaviors.")]),e._v(" "),t("h3",{attrs:{id:"_5-1-intrinsic-views-on-hallucinatory-behavior"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-intrinsic-views-on-hallucinatory-behavior"}},[e._v("#")]),e._v(" 5.1 Intrinsic Views on Hallucinatory Behavior")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("Probing for Truthfulness")]),e._v(": Probes trained on middle and last layers' representations can predict the truthfulness of model outputs.")]),e._v(" "),t("li",[t("strong",[e._v("Truthfulness Directions")]),e._v(': Linear interventions in the direction of "truthfulness" can enhance the factual accuracy of model predictions.')])]),e._v(" "),t("h3",{attrs:{id:"_5-2-recall-of-factual-associations"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-recall-of-factual-associations"}},[e._v("#")]),e._v(" 5.2 Recall of Factual Associations")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("Factual Recall Circuit")]),e._v(": The model recalls factual information through a multi-step process. Early-middle FFNs add information about the subject to the residual stream, while later attention heads extract the correct attribute (e.g., the capital of a country).")]),e._v(" "),t("li",[t("strong",[e._v("Additive Mechanism")]),e._v(": Attention heads' OV circuits decode attributes by combining information from the subject and relation. Some heads are "),t("strong",[e._v("subject heads")]),e._v(" (independent of the relation), "),t("strong",[e._v("relation heads")]),e._v(" (independent of the subject), and "),t("strong",[e._v("mixed heads")]),e._v(" (dependent on both).")])]),e._v(" "),t("h3",{attrs:{id:"_5-3-factuality-issues-and-model-editing"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-factuality-issues-and-model-editing"}},[e._v("#")]),e._v(" 5.3 Factuality Issues and Model Editing")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("Model Editing")]),e._v(": Techniques like "),t("strong",[e._v("causal interventions")]),e._v(" and "),t("strong",[e._v("knowledge neuron localization")]),e._v(" have been used to edit factual associations in models. However, these approaches face challenges like "),t("strong",[e._v("catastrophic forgetting")]),e._v(" and "),t("strong",[e._v("downstream performance loss")]),e._v(".")])]),e._v(" "),t("hr"),e._v(" "),t("h2",{attrs:{id:"conclusion"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#conclusion"}},[e._v("#")]),e._v(" Conclusion")]),e._v(" "),t("p",[e._v("The inner workings of Transformer-based language models are complex and multifaceted. By understanding the behaviors of individual components like attention heads, FFN neurons, and the residual stream, we can gain insights into how these models process and generate language. Moreover, the emergent behaviors that arise from the interaction of these components highlight the importance of studying models as a whole, rather than focusing on individual parts.")]),e._v(" "),t("p",[e._v("As research in this area continues, we can expect to uncover even more fascinating details about how these models work, paving the way for more interpretable, reliable, and safe AI systems.")]),e._v(" "),t("hr"),e._v(" "),t("p",[t("em",[e._v('This blog is based on the paper "A Primer on the Inner Workings of Transformer-based Language Models" by Javier Ferrando, Gabriele Sarti, Arianna Bisazza, and Marta R. Costa-jussà.')])])])}),[],!1,null,null,null);t.default=i.exports}}]);